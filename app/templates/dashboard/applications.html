{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Your Job Applications</h2>
    
    {% if current_user.job_applications %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th>Job Title</th>
                        <th>Company</th>
                        <th>Status</th>
                        <th>Date Applied</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for application in current_user.job_applications %}
                    <tr>
                        <td>
                            <a href="{{ url_for('jobs.job_detail', job_id=application.job.id) }}">
                                {{ application.job.title }}
                            </a>
                        </td>
                        <td>{{ application.job.company }}</td>
                        <td>
                            <span class="badge 
                                {% if application.status == 'Accepted' %}bg-success
                                {% elif application.status == 'Rejected' %}bg-danger
                                {% else %}bg-warning text-dark{% endif %}">
                                {{ application.status }}
                            </span>
                        </td>
                        <td>{{ application.date_applied.strftime('%Y-%m-%d') }}</td>
                        <td>
                            <a href="{{ url_for('jobs.application_detail', application_id=application.id) }}" 
                               class="btn btn-sm btn-info">
                                <i class="fas fa-eye"></i> View
                            </a>
                            {% if application.status == 'Pending' %}
                            <form action="{{ url_for('jobs.withdraw_application', application_id=application.id) }}" 
                                  method="POST" class="d-inline">
                                <button type="submit" class="btn btn-sm btn-danger" 
                                        onclick="return confirm('Are you sure you want to withdraw this application?')">
                                    <i class="fas fa-trash-alt"></i> Withdraw
                                </button>
                            </form>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% extends "base.html" %}  <!-- Assuming you have a base template -->
{% block content %}

<!-- Job Details Section -->
<div class="job-details">
  <h2>{{ job.title }}</h2>
  <p><strong>Company:</strong> {{ job.employer.company_name }}</p>
  <p><strong>Location:</strong> {{ job.location }}</p>
  <p><strong>Salary:</strong> {{ job.salary }}</p>
  <p><strong>Description:</strong> {{ job.description }}</p>
</div>

<!-- Application Logic -->
<div class="application-section">
  {% if current_user.is_authenticated %}
    {% if current_user.role == 'jobseeker' %}
      <!-- Check if user has already applied -->
      {% set has_applied = application_exists(current_user.id, job.id) %}  <!-- Using a custom template function -->
      {% if has_applied %}
        <div class="alert alert-info">
          You've already applied to this job!
        </div>
        <button class="btn btn-secondary" disabled>Applied</button>
      {% else %}
        <a href="{{ url_for('apply', job_id=job.id) }}" class="btn btn-primary">Apply Now</a>
      {% endif %}
    {% elif current_user.role == 'employer' %}
      <p>Employers cannot apply to jobs.</p>
    {% endif %}
  {% else %}
    <div class="alert alert-warning">
      <a href="{{ url_for('login') }}">Log in</a> as a jobseeker to apply.
    </div>
  {% endif %}
</div>

{% endblock %}
    {% else %}
        <div class="alert alert-info">
            You haven't applied to any jobs yet. 
            <a href="{{ url_for('jobs.job_list') }}" class="alert-link">
                Browse available jobs
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}